applications:

    nodejs_app: 
        source:
            root: apps/nodejs
        stack:
            - nodejs@22
            - nodePackages.npm
            - python@3.12
            - python312Packages.pip
        hooks:
            build: |
                set -e
                pip install -r requirements.txt
                npm install
                npm run build

        relationships:
            database:
            
        web:
            commands:
                start: npm run start

        mounts:
            'test-mount':
                source: storage
                source_path: files
            'test-mountb':
                source: service
                service: network-storage
                source_path: filesb

        workers:
            watchdog:
                commands:
                    start: |
                        python watch.py $PLATFORM_APP_DIR/test-mount
            watchdogb:
                commands:
                    start: |
                        python watch.py $PLATFORM_APP_DIR/test-mountb


services:
    database:
        type: mariadb:10.4

    ns:
        type: network-storage:2.0

routes:

    "https://{default}/":
        type: upstream
        primary: true
        upstream: "nodejs_app:http"
    "https://www.{default}":
        type: redirect
        to: "https://{default}/"
