applications:

    nodejs_app: 
        source:
            root: apps/nodejs
        stack:
            - nodejs@22
            - nodePackages.npm
            - python@3.12
            - python312Packages.pip
            - inotify-tools
        hooks:
            build: |
                set -e
                pip install -r requirements.txt
                npm install
                npm run build
        web:
            commands:
                start: npm run start
        # access:
        #     ssh: admin
        mounts:
            'sensitive-data':
                source: storage
        workers:
            watchdog:
                commands:
                    start: |
                        python watch.py $PLATFORM_APP_DIR/sensitive-data
        relationships:
            database:
services:
    database:
        type: mariadb:10.4

routes:

    "https://{default}/":
        type: upstream
        primary: true
        upstream: "nodejs_app:http"
    "https://www.{default}":
        type: redirect
        to: "https://{default}/"
